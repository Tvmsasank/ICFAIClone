@model ICFAIClone.Models.AdminDashboardViewModel

@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container my-5">
    <h2 class="mb-3 text-primary">Welcome, Admin!</h2>
    <p class="mb-4">Here you can check out the enquiries made by students and solve their queries!</p>

    <div class="d-flex gap-3 mb-4">
        <form asp-action="Logout" asp-controller="Admin" method="post">
            <button type="submit" class="btn btn-danger">Logout</button>
        </form>

        <form asp-action="Create" asp-controller="Student" method="post">
            <button type="submit" class="btn btn-warning">Create Database for Student</button>
        </form>
    </div>

@if (Model.Students != null && Model.Students.Count > 0)
{
        <form asp-action="UpdateAllStudents" asp-controller="Admin" method="post">
                <h4 class="text-danger mb-3">STUDENT TABLE</h4>
                <div class="table table-responsive mb-4 shadow-sm rounded">
                    <table class="table table-bordered table-striped align-middle mb-0">
                        <thead class="table-dark">
                        <tr class="text-nowrap">
                            <th>Username</th>
                            <th>Password</th>
                            <th>IsActive</th>
                            <th>Course</th>
                            <th>DateOfBirth</th>
                            <th>StudentId</th>
                            <th>Email</th>
                            <th>EnrollmentNumber</th>
                            <th>FullName</th>
                            <th>Fees</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.Students.Count; i++)
                        {
                            <tr>
                                <td>
                                    <input type="hidden" name="Students[@i].StudentId" value="@Model.Students[i].StudentId" />
                                    <input type="text" name="Students[@i].Username" value="@Model.Students[i].Username" class="form-control" />
                                </td>
                                <td>
                                    <input type="text" name="Students[@i].Password" value="@Model.Students[i].Password" class="form-control" />
                                </td>
                                <td class="text-center">
                                    <input type="checkbox" name="Students[@i].IsActive" value="true" @(Model.Students[i].IsActive ? "checked" : "") />
                                </td>
                                <td>
                                    <input type="text" name="Students[@i].Course" value="@Model.Students[i].Course" class="form-control" />
                                </td>
                                <td>
                                    <input type="date" name="Students[@i].DateOfBirth" value="@Model.Students[i].DateOfBirth?.ToString("yyyy-MM-dd")" class="form-control" />
                                </td>
                                <td class="text-nowrap">@Model.Students[i].StudentId</td>
                                <td>
                                    <input type="email" name="Students[@i].Email" value="@Model.Students[i].Email" class="form-control" />
                                </td>
                                <td>
                                    <input type="text" name="Students[@i].EnrollmentNumber" value="@Model.Students[i].EnrollmentNumber" class="form-control" />
                                </td>
                                <td>
                                    <input type="text" name="Students[@i].FullName" value="@Model.Students[i].FullName" class="form-control" />
                                </td>
                                <td>
                                    <input type="number" name="Students[@i].Fees" value="@Model.Students[i].Fees" class="form-control" />
                                </td>
                                <td class="text-center">
                                    <button type="button"
                                            class="btn btn-sm btn-danger delete-student-btn"
                                            data-id="@Model.Students[i].StudentId">
                                        Delete
                                    </button>
                                </td>

                            </tr>
                        }
                    </tbody>
                </table>
                <div class="text-end mt-3">
                    <button type="submit" class="btn btn-success px-4">Update All Students</button>
                </div>
        </form>
}
else
{
        <div class="alert alert-warning">No students found.</div>
}

@if (Model.Enquiries != null && Model.Enquiries.Count > 0)
{
        <div class="table-responsive mb-5">
            <h4 class="text-danger">ENQUIRY TABLE</h4>
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var enquiry in Model.Enquiries)
                    {
                        <tr>
                            <form asp-action="EditEnquiry" asp-controller="Admin" method="post">
                            <td>
                                <input type="hidden" name="EnquiryId" value="@enquiry.EnquiryId" />
                                <input type="text" name="Name" value="@enquiry.Name" class="form-control" />
                            </td>
                            <td>
                                <input type="text" name="Email" value="@enquiry.Email" class="form-control" />
                            </td>
                            <td>
                                <input type="text" name="Phone" value="@enquiry.Phone" class="form-control" />
                            </td>
                            <td>
                                <input type="text" name="Address" value="@enquiry.Address" class="form-control" />
                            </td>
                            <td class="text-center">
                                <button type="submit" class="btn btn-sm btn-success">Update</button>
                                <a asp-action="DeleteEnquiry" asp-controller="Admin" asp-route-id="@enquiry.EnquiryId" class="btn btn-sm btn-danger">Delete</a>
                            </td>
                            </form>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
}
else
{
        <div class="alert alert-warning">No enquiries found.</div>
}

@section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                // 🔴 Delete Student
                $(".delete-student-btn").click(function () {
                    if (confirm("Are you sure you want to delete this student?")) {
                        var id = $(this).data("id");
                        $.ajax({
                            url: '/Admin/DeleteStudent',
                            type: 'POST',
                            data: { id: id },
                            success: function () {
                                alert("Student deleted successfully!");
                                location.reload(); // or remove row dynamically
                            },
                            error: function () {
                                alert("Error deleting student.");
                            }
                        });
                    }
                });

                // 🔴 Delete Enquiry
                $(".delete-enquiry-btn").click(function () {
                    if (confirm("Are you sure you want to delete this enquiry?")) {
                        var id = $(this).data("id");
                        $.ajax({
                            url: '/Admin/DeleteEnquiry',
                            type: 'POST',
                            data: { id: id },
                            success: function () {
                                alert("Enquiry deleted successfully!");
                                location.reload();
                            },
                            error: function () {
                                alert("Error deleting enquiry.");
                            }
                        });
                    }
                });
            });
        </script>
}
